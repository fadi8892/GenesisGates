<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Genesis Gates</title>

    <!-- Tailwind (CDN for now; fine to ship while we stabilize UI) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Leaflet CSS -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-o9N1j7kG96bJc9v+g32GkMoqQWwM9C0l9v+0iX6pH6k="
      crossorigin=""
    />

    <style>
      html, body { height: 100%; }
      .tab.active { background: #eef2ff; }
      /* smooth card look */
      .card { border-radius: 1rem; border: 1px solid #e5e7eb; padding: 1rem; }
    </style>
  </head>
  <body class="bg-white text-slate-900">
    <!-- Header -->
    <header class="border-b">
      <div class="max-w-5xl mx-auto px-4 py-3 flex items-center gap-3">
        <div class="w-8 h-8 rounded-xl bg-indigo-600"></div>
        <div class="font-semibold text-lg">Genesis Gates</div>
        <div class="ml-auto text-xs text-slate-500">Your family history. Decentralized. Immortalized.</div>
      </div>
    </header>

    <main class="max-w-5xl mx-auto p-4">
      <!-- Landing -->
      <section id="landing" class="grid md:grid-cols-2 gap-4">
        <!-- View a Tree (Code) -->
        <div class="card">
          <div class="text-sm font-semibold mb-2">View a Tree (Code)</div>
          <div class="flex gap-2">
            <input id="viewCode" class="w-full rounded-xl border px-3 py-2" placeholder="AAAAA-BBBBB-CCCCC-DDDDD-EEEEE" />
            <button id="btnOpenCode" class="rounded-xl px-4 py-2 bg-indigo-600 text-white">Open</button>
          </div>
          <div id="codeStatus" class="mt-2 text-xs text-slate-500"></div>
        </div>

        <!-- Log in to Edit -->
        <div class="card">
          <div class="text-sm font-semibold mb-2">Log in to Edit</div>
          <div class="flex gap-2">
            <input id="ownerPass" class="w-full rounded-xl border px-3 py-2" type="password" placeholder="Passphrase (stored only in this browser)" />
            <button id="btnOwnerCreate" class="rounded-xl px-3 py-2 border">Create/Replace Key</button>
            <button id="btnOwnerLogin" class="rounded-xl px-4 py-2 bg-emerald-600 text-white">Login</button>
          </div>
          <div class="mt-2 text-xs">Owner key status: <span id="ownerStatus">Unknown</span></div>
        </div>

        <!-- Start a New Tree -->
        <div class="card">
          <div class="text-sm font-semibold mb-2">Start a New Tree</div>
          <button id="btnCreateNewTree" class="rounded-xl px-4 py-2 bg-amber-600 text-white">Start New</button>
        </div>

        <!-- Web3.Storage token -->
        <div class="card">
          <div class="text-sm font-semibold mb-2">Web3.Storage</div>
          <p class="text-xs text-slate-500 mb-2">Paste your Web3.Storage API token. This stays in your browser.</p>
          <div class="flex gap-2">
            <input id="w3sToken" class="w-full rounded-xl border px-3 py-2" placeholder="w3s-..." />
            <button id="btnSaveToken" class="rounded-xl px-4 py-2 bg-slate-800 text-white">Save Token</button>
          </div>
        </div>
      </section>

      <!-- App Shell (hidden until you enter Viewer/Owner) -->
      <section id="app" class="hidden">
        <!-- Top bar -->
        <div class="flex items-center justify-between px-4 py-3 border rounded-xl mt-4">
          <div class="font-semibold">Genesis Gates</div>
          <div class="text-xs">Mode: <span id="modeBadge">Viewer</span></div>
          <div class="flex items-center gap-2">
            <button id="btnShare" class="rounded-lg px-3 py-1.5 border">Share</button>
            <button id="btnPublish" class="rounded-lg px-3 py-1.5 bg-indigo-600 text-white">Publish</button>
            <button id="btnLogout" class="rounded-lg px-3 py-1.5 border">Exit</button>
          </div>
        </div>

        <!-- Tabs -->
        <div class="flex gap-2 p-3 border rounded-xl mt-4">
          <button class="tab rounded-lg px-3 py-1.5 bg-slate-100" data-tab="overview">Overview</button>
          <button class="tab rounded-lg px-3 py-1.5" data-tab="tree">Tree</button>
          <button class="tab rounded-lg px-3 py-1.5" data-tab="map">Map</button>
          <button class="tab rounded-lg px-3 py-1.5" data-tab="media">Media</button>
          <button class="tab rounded-lg px-3 py-1.5" data-tab="sources">Sources</button>
          <button class="tab rounded-lg px-3 py-1.5" data-tab="reports">Reports</button>
          <button class="tab rounded-lg px-3 py-1.5" data-tab="settings">Settings</button>
        </div>

        <!-- Panels -->
        <div id="panel-overview" class="p-4 border rounded-xl mt-4">
          <div class="overflow-x-auto">
            <table class="w-full text-sm">
              <thead><tr><th class="text-left py-2">Name</th><th class="text-left">Sex</th><th class="text-left">Birth</th><th class="text-left">Death</th><th></th></tr></thead>
              <tbody id="peopleRows"></tbody>
            </table>
          </div>
          <div id="editLock" class="text-xs text-amber-600 mt-2 hidden">Login to edit.</div>

          <div class="mt-4 grid gap-2 max-w-xl">
            <input id="pId" type="hidden" />
            <input id="pName" class="form rounded border px-3 py-2" placeholder="Full name" />
            <select id="pSex" class="form rounded border px-3 py-2">
              <option value="">— Sex —</option><option value="M">M</option><option value="F">F</option>
            </select>
            <input id="pBirthDate" class="form rounded border px-3 py-2" placeholder="Birth date (YYYY-MM-DD)" />
            <input id="pBirthPlace" class="form rounded border px-3 py-2" placeholder="Birthplace (city, country)" />
            <input id="pDeathDate" class="form rounded border px-3 py-2" placeholder="Death date (YYYY-MM-DD)" />
            <input id="pDeathPlace" class="form rounded border px-3 py-2" placeholder="Death place (city, country)" />
            <input id="pResidencePlace" class="form rounded border px-3 py-2" placeholder="Residence (city, country)" />
            <div class="flex gap-2">
              <button id="btnSavePerson" class="form rounded px-3 py-2 bg-emerald-600 text-white">Save</button>
              <button id="btnClearForm" class="form rounded px-3 py-2 border">Clear</button>
            </div>
            <div class="flex gap-2 mt-2">
              <button id="btnLocatePlaces" class="form rounded px-3 py-2 border">Locate Places</button>
              <input id="fileImportJSON" type="file" accept="application/json" class="hidden" />
              <label for="fileImportJSON" class="form rounded px-3 py-2 border cursor-pointer">Import JSON</label>
              <button id="btnExportJSON" class="form rounded px-3 py-2 border">Export JSON</button>
              <input id="fileImportGED" type="file" accept=".ged,.GED" class="hidden" />
              <label for="fileImportGED" class="form rounded px-3 py-2 border cursor-pointer">Import GEDCOM</label>
              <button id="btnExportGED" class="form rounded px-3 py-2 border">Export GEDCOM</button>
            </div>
          </div>
        </div>

        <div id="panel-tree" class="p-0 border rounded-xl mt-4 hidden">
          <div class="flex items-center gap-2 p-3 border-b">
            <select id="rootSelect" class="rounded border px-2 py-1"></select>
            <input id="treeSearch" class="rounded border px-2 py-1" placeholder="Search name…" />
            <button id="btnTreeSearch" class="rounded px-2 py-1 border">Find</button>
            <button id="btnFitTree" class="rounded px-2 py-1 border">Fit</button>
            <button id="btnCenterTree" class="rounded px-2 py-1 border">Center</button>
            <button id="btnResetTree" class="rounded px-2 py-1 border">Reset</button>
            <label class="ml-4 text-sm"><input type="radio" name="diagram" value="tree" checked> Tree</label>
            <label class="text-sm"><input type="radio" name="diagram" value="radial"> Radial</label>
          </div>
          <div id="treeHost" style="height: calc(100vh - 260px);"></div>
        </div>

        <div id="panel-map" class="p-0 border rounded-xl mt-4 hidden">
          <div class="flex items-center gap-2 p-3 border-b">
            <label class="text-sm"><input id="chkHeat" type="checkbox" checked> Heat</label>
            <label class="text-sm"><input id="chkArcs" type="checkbox" checked> Arcs</label>
            <button id="btnGeoAll" class="rounded px-2 py-1 border">Geocode all</button>
            <span id="geoStatus" class="text-xs text-slate-500"></span>
          </div>
          <div id="map" style="height: calc(100vh - 260px);"></div>
        </div>

        <div id="panel-media" class="p-4 border rounded-xl mt-4 hidden">
          <input id="fileMedia" type="file" multiple class="mb-3" />
          <div id="mediaGrid" class="grid grid-cols-2 md:grid-cols-3 gap-3"></div>
        </div>

        <div id="panel-sources" class="p-4 border rounded-xl mt-4 hidden">
          <button id="btnAddSource" class="rounded px-3 py-1.5 border mb-3">Add Source</button>
          <button id="btnExportSources" class="rounded px-3 py-1.5 border mb-3 ml-2">Export Sources JSON</button>
          <div id="sourceList" class="grid gap-2"></div>
        </div>

        <div id="panel-reports" class="p-4 border rounded-xl mt-4 hidden">
          <div class="flex flex-wrap gap-4 mb-3">
            <div>Ancestor of <select id="reportRootA"></select> <button id="btnReportA" class="rounded px-2 py-1 border">Generate</button></div>
            <div>Descendant of <select id="reportRootD"></select> <button id="btnReportD" class="rounded px-2 py-1 border">Generate</button></div>
            <div><button id="btnReportT" class="rounded px-2 py-1 border">Timeline</button></div>
          </div>
          <pre id="reportOut" class="text-sm bg-slate-50 p-3 rounded-xl"></pre>
        </div>

        <div id="panel-settings" class="p-4 border rounded-xl mt-4 hidden">
          <label class="block text-sm"><input id="optLargeNodes" type="checkbox"> Larger nodes</label>
          <label class="block text-sm"><input id="optShowSpouses" type="checkbox" checked> Show spouses</label>
          <label class="block text-sm"><input id="optCurvedLinks" type="checkbox" checked> Curved links</label>
        </div>
      </section>
    </main>

    <!-- App code -->
    <script type="module" src="/app.js"></script>
  </body>
</html>
