{% extends "base.html" %}

{% block content %}
<h2 class="mb-3">{{ tree.name }}</h2>
<p class="text-muted">{{ tree.description }}</p>

{% if can_edit %}
<div class="row">
    <div class="col-md-6">
        <h4>Add a person</h4>
        <form method="post" action="/tree/{{ tree.id }}/add-person" class="mb-4">
            <div class="mb-2">
                <label for="first_name" class="form-label">First name</label>
                <input type="text" class="form-control" id="first_name" name="first_name" required>
            </div>
            <div class="mb-2">
                <label for="last_name" class="form-label">Last name</label>
                <input type="text" class="form-control" id="last_name" name="last_name">
            </div>
            <div class="mb-2">
                <label for="birth_date" class="form-label">Birth date</label>
                <input type="date" class="form-control" id="birth_date" name="birth_date">
            </div>
            <div class="mb-2">
                <label for="death_date" class="form-label">Death date</label>
                <input type="date" class="form-control" id="death_date" name="death_date">
            </div>
            <div class="mb-2">
                <label for="gender" class="form-label">Gender</label>
                <select class="form-select" id="gender" name="gender">
                    <option value="">-- Select --</option>
                    <option value="male">Male</option>
                    <option value="female">Female</option>
                    <option value="other">Other</option>
                </select>
            </div>
            <div class="mb-2">
                <label for="biography" class="form-label">Biography</label>
                <textarea class="form-control" id="biography" name="biography" rows="3"></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Add Person</button>
        </form>
    </div>
    <div class="col-md-6">
        <h4>Add a relationship</h4>
        <form method="post" action="/tree/{{ tree.id }}/add-relationship" class="mb-4">
            <div class="mb-2">
                <label for="person_id" class="form-label">Person</label>
                <select class="form-select" id="person_id" name="person_id" required>
                    {% for pid, person in persons.items() %}
                    <option value="{{ pid }}">{{ person.first_name }} {{ person.last_name or '' }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="mb-2">
                <label for="related_person_id" class="form-label">Related person</label>
                <select class="form-select" id="related_person_id" name="related_person_id" required>
                    {% for pid, person in persons.items() %}
                    <option value="{{ pid }}">{{ person.first_name }} {{ person.last_name or '' }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="mb-2">
                <label for="relation_type" class="form-label">Relationship type</label>
                <select class="form-select" id="relation_type" name="relation_type" required>
                    <option value="parent">Parent</option>
                    <option value="spouse">Spouse</option>
                    <option value="sibling">Sibling</option>
                </select>
            </div>
            <button type="submit" class="btn btn-primary">Add Relationship</button>
        </form>
    </div>
</div>
{% endif %}

<h4 class="mt-4">People in this tree</h4>
{% if persons %}
<div class="table-responsive mb-4">
    <table class="table table-sm table-bordered">
        <thead>
            <tr>
                <th scope="col">ID</th>
                <th scope="col">Name</th>
                <th scope="col">Born</th>
                <th scope="col">Died</th>
                <th scope="col">Gender</th>
            </tr>
        </thead>
        <tbody>
            {% for pid, person in persons.items() %}
            <tr>
                <td>{{ pid }}</td>
                <td>{{ person.first_name }} {{ person.last_name or '' }}</td>
                <td>{{ person.birth_date or '' }}</td>
                <td>{{ person.death_date or '' }}</td>
                <td>{{ person.gender or '' }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<p>No persons have been added yet.</p>
{% endif %}

<h4 class="mt-4">Family tree</h4>
{% if structure.roots %}
<ul>
{% for root in structure.roots %}
    {% include "_tree_node.html" with root=root %}
{% endfor %}
</ul>
{% else %}
<p>This tree has no people yet.</p>
{% endif %}

{% endblock %}
