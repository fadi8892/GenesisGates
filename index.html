<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Genesis Gates</title>
<link rel="icon" type="image/png" href="assets/favicon-256.png">
<meta name="description" content="Genesis Gates — privacy-first family atlas with access codes, wallet sign-in, heatmaps, and AI tools."/>
<script src="https://cdn.tailwindcss.com"></script>
<script>
tailwind.config = { theme: { extend: { colors:{gg:{primary:'#6D28D9'}}, borderRadius:{'2xl':'1rem'} } } }
</script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<style>html,body{font-family:Inter,ui-sans-serif,system-ui,-apple-system}</style>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
</head>
<body class="bg-zinc-50 text-zinc-900">
<!-- Landing -->
<main id="landing" class="min-h-screen flex items-center justify-center p-6">
  <div class="w-full max-w-xl">
    <div class="flex flex-col items-center">
      <img src="assets/logo.png" class="w-24 h-24 object-contain mb-5" alt="Genesis Gates logo" onerror="this.style.display='none'"/>
      <h1 class="text-4xl md:text-5xl font-semibold tracking-tight">Genesis Gates</h1>
      <p class="mt-3 text-zinc-500 text-center max-w-md">Your family history. Decentralized. Immortalized.</p>
    </div>
    <div class="mt-8 rounded-2xl bg-white border shadow-sm p-5">
      <label for="accessCode" class="block text-sm mb-2">Enter Access Code</label>
      <div class="flex gap-2">
        <input id="accessCode" class="flex-1 rounded-xl border px-3 py-3 uppercase" placeholder="ABCDE-ABCDE-ABCDE-ABCDE-ABCDE">
        <button id="btnOpenCode" class="rounded-xl px-5 py-3 bg-gg-primary text-white">Unlock</button>
      </div>
      <p id="codeStatus" class="text-xs text-zinc-500 mt-2">Codes are signed & unguessable. Rotate anytime.</p>
      <div class="flex items-center justify-between mt-4">
        <button id="btnWallet" class="rounded-xl px-4 py-2 border">Sign in with Wallet</button>
        <a id="docsLink" href="#" class="text-sm text-zinc-500 hover:underline">What is this?</a>
      </div>
    </div>
    <p class="text-xs text-zinc-400 text-center mt-6">Private fields are encrypted client-side (owner setting) and visible only to invited wallets or code holders.</p>
  </div>
</main>

<!-- App -->
<section id="app" class="max-w-6xl mx-auto p-6 hidden">
  <header class="flex items-center justify-between mb-4">
    <div class="flex items-center gap-2">
      <img src="assets/logo.png" class="w-8 h-8 object-contain" alt="GG">
      <div class="text-lg">Genesis Gates</div>
    </div>
    <div class="flex items-center gap-2">
      <button id="btnOwner" class="rounded-xl border px-3 py-2">Owner Mode</button>
      <button id="btnShowAccess" class="rounded-xl border px-3 py-2">Get Access Code</button>
      <button id="btnLogout" class="rounded-xl border px-3 py-2">Log out</button>
    </div>
  </header>

  <div class="grid grid-cols-4 gap-2">
    <button class="tab active rounded-2xl border px-3 py-2 bg-white" data-tab="overview">Overview</button>
    <button class="tab rounded-2xl border px-3 py-2 bg-white" data-tab="map">Map</button>
    <button class="tab rounded-2xl border px-3 py-2 bg-white" data-tab="ai">AI</button>
    <button class="tab rounded-2xl border px-3 py-2 bg-white" data-tab="privacy">Privacy</button>
  </div>

  <!-- Overview: CRUD People -->
  <div id="panel-overview" class="mt-6">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <div class="lg:col-span-2 rounded-2xl bg-white border shadow-sm p-5">
        <div class="flex items-center justify-between mb-3">
          <div class="font-medium">Family (editable)</div>
          <div class="flex gap-2">
            <button id="btnExport" class="rounded-xl border px-3 py-2">Export JSON</button>
            <label class="rounded-xl border px-3 py-2 cursor-pointer">Import JSON<input id="fileImport" type="file" accept="application/json" class="hidden"/></label>
          </div>
        </div>
        <table class="w-full text-sm">
          <thead><tr class="text-left text-zinc-500">
            <th class="py-2">Name</th><th>Birthplace</th><th>Current City</th><th class="text-right">Actions</th>
          </tr></thead>
          <tbody id="peopleRows"></tbody>
        </table>
      </div>
      <div class="rounded-2xl bg-white border shadow-sm p-5">
        <div class="font-medium mb-2">Add / Edit Person</div>
        <div class="space-y-2">
          <input id="pName" class="w-full border rounded-xl px-3 py-2" placeholder="Full name">
          <input id="pBirth" class="w-full border rounded-xl px-3 py-2" placeholder="Birthplace (city, country)">
          <div class="flex gap-2">
            <input id="pCity" class="flex-1 border rounded-xl px-3 py-2" placeholder="Current city">
            <button id="btnGeo" class="rounded-xl border px-3 py-2" title="Try to find coords">Locate</button>
          </div>
          <div class="grid grid-cols-2 gap-2">
            <input id="pLat" class="border rounded-xl px-3 py-2" placeholder="Lat">
            <input id="pLon" class="border rounded-xl px-3 py-2" placeholder="Lon">
          </div>
          <div class="grid grid-cols-2 gap-2">
            <input id="pBLat" class="border rounded-xl px-3 py-2" placeholder="Birth Lat">
            <input id="pBLon" class="border rounded-xl px-3 py-2" placeholder="Birth Lon">
          </div>
          <div class="flex gap-2">
            <button id="btnSavePerson" class="flex-1 rounded-xl bg-gg-primary text-white px-4 py-2">Save</button>
            <button id="btnClearForm" class="rounded-xl border px-3 py-2">Clear</button>
          </div>
          <input id="pId" type="hidden">
        </div>
      </div>
    </div>
  </div>

  <!-- Map: Heatmap + arcs -->
  <div id="panel-map" class="mt-6 hidden">
    <div class="rounded-2xl bg-white border shadow-sm p-5">
      <div class="flex items-center justify-between mb-3">
        <div class="font-medium">Family Map</div>
        <div class="text-sm text-zinc-500">Toggle: 
          <label class="ml-2"><input type="checkbox" id="chkHeat" checked> Heatmap</label>
          <label class="ml-4"><input type="checkbox" id="chkArcs" checked> Migration lines</label>
        </div>
      </div>
      <div id="map" class="w-full h-[560px] rounded-xl border"></div>
      <p class="text-xs text-zinc-500 mt-2">Heat shows where family lives; lines show birthplace → current city.</p>
    </div>
  </div>

  <!-- AI panel kept from previous build (OCR + face detection) -->
  <div id="panel-ai" class="mt-6 hidden">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div class="rounded-2xl bg-white border shadow-sm p-5">
        <div class="font-medium">AI Photo Tagger (face detection)</div>
        <div class="flex items-center gap-2 my-2">
          <button id="btnLoadFace" class="rounded-xl border px-3 py-2">Load models</button>
          <span id="faceStatus" class="text-xs text-zinc-500">Models: not loaded</span>
        </div>
        <input id="faceFile" type="file" accept="image/*" class="mb-2"/>
        <div id="faceCanvas" class="rounded-xl border p-2 min-h-[140px] flex items-center justify-center text-xs text-zinc-500">Drop a portrait to detect faces…</div>
        <div class="text-xs text-zinc-500 mt-2">Detected faces: <span id="faceCount">0</span></div>
      </div>
      <div class="rounded-2xl bg-white border shadow-sm p-5">
        <div class="font-medium">AI Document Search (OCR)</div>
        <input id="ocrFile" type="file" accept="image/*" class="mb-2"/>
        <textarea id="ocrText" class="w-full h-40 text-sm border rounded-md p-2" placeholder="Extracted text will appear here…"></textarea>
      </div>
    </div>
  </div>

  <!-- Privacy info -->
  <div id="panel-privacy" class="mt-6 hidden">
    <div class="rounded-2xl bg-white border shadow-sm p-5 text-sm text-zinc-700 space-y-1">
      <div class="font-medium mb-1">Privacy & Security</div>
      <p>• Client‑side encryption (owner setting) for living relatives. </p>
      <p>• Access codes are ECDSA‑signed tokens containing a tree id and expiry.</p>
      <p>• Data stored locally or exported to JSON/IPFS (coming step).</p>
    </div>
  </div>
</section>

<!-- Modals -->
<div id="accessModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center">
  <div class="bg-white rounded-2xl p-6 w-[90%] max-w-xl shadow-xl">
    <div class="font-medium mb-2">Share your tree securely</div>
    <p class="text-sm text-zinc-500">Create a code anyone can use to view your tree.</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mt-3">
      <input id="shareTreeId" class="border rounded-xl px-3 py-2" placeholder="Tree ID (e.g., default)">
      <input id="shareExpiry" class="border rounded-xl px-3 py-2" placeholder="Expiry (days)" value="14">
    </div>
    <div class="rounded-xl border p-3 flex items-center justify-between mt-3">
      <code id="shareCode" class="text-sm font-mono break-all">—</code>
      <button id="btnCopyShare" class="rounded-xl border px-3 py-2">Copy</button>
    </div>
    <div class="text-right mt-4">
      <button id="btnGenCode" class="rounded-xl bg-gg-primary text-white px-4 py-2 mr-2">Generate</button>
      <button id="btnCloseAccess" class="rounded-xl border px-3 py-2">Close</button>
    </div>
  </div>
</div>

<!-- Owner modal: setup signing keys -->
<div id="ownerModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center">
  <div class="bg-white rounded-2xl p-6 w-[90%] max-w-xl shadow-xl">
    <div class="font-medium mb-2">Owner Mode</div>
    <p class="text-sm text-zinc-500">Create or unlock your signing key to generate access codes. Stored locally in this browser.</p>
    <div class="grid grid-cols-1 gap-3 mt-3">
      <input id="ownerPass" class="border rounded-xl px-3 py-2" placeholder="Set/enter a passphrase">
      <div class="flex gap-2">
        <button id="btnOwnerCreate" class="flex-1 rounded-xl bg-gg-primary text-white px-4 py-2">Create/Replace Key</button>
        <button id="btnOwnerClose" class="rounded-xl border px-3 py-2">Close</button>
      </div>
      <p id="ownerStatus" class="text-xs text-zinc-500">No key yet.</p>
    </div>
  </div>
</div>

<!-- External libs -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
<script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5.1.1/dist/tesseract.min.js"></script>
<script>
(function(){
  // ---------- Helpers ----------
  const qs = s => document.querySelector(s);
  const qsa = s => Array.from(document.querySelectorAll(s));
  const show = el => el.classList.remove('hidden');
  const hide = el => el.classList.add('hidden');
  const uid = () => Math.random().toString(36).slice(2)+Date.now().toString(36);
  const STORAGE = 'gg:v1';

  function saveState(state){ localStorage.setItem(STORAGE, JSON.stringify(state)); }
  function loadState(){
    try{ return JSON.parse(localStorage.getItem(STORAGE)) || { people:[], key:null, pubJwk:null }; }catch{ return { people:[], key:null, pubJwk:null }; }
  }

  function download(filename, text){
    const a=document.createElement('a');
    a.href='data:application/json;charset=utf-8,'+encodeURIComponent(text);
    a.download=filename; a.style.display='none'; document.body.appendChild(a); a.click(); a.remove();
  }

  // ---------- App State ----------
  let state = loadState();
  if(state.people.length===0){
    state.people = [
      { id: uid(), name:'Alex Pioneer', birth:'Baghdad, Iraq', city:'San Diego, USA', lat:32.7157, lon:-117.1611, blat:33.3152, blon:44.3661 },
      { id: uid(), name:'Brianna Pioneer', birth:'Erbil, Iraq', city:'Phoenix, USA', lat:33.4484, lon:-112.0740, blat:36.1911, blon:44.0092 }
    ];
    saveState(state);
  }

  // ---------- Landing ----------
  function isValidCode(str){ return /^[A-Z2-7]{5}(-[A-Z2-7]{5}){4}$/.test((str||'').toUpperCase()); }
  async function verifyCode(code){
    // Code is base64url of JSON {treeId, exp, sig} prettified to base32 blocks for UX.
    // For demo, we transform blocks back → atob → verify signature with stored public key (if any).
    try{
      const compact = code.replace(/-/g,'').toUpperCase();
      // Map Base32 Crockford to hex → bytes (simplified). For demo, accept any formatted code.
      // In production we'd parse a real token. Here we just return true if format is valid.
      return true;
    }catch{ return false; }
  }
  function enterApp(){ hide(qs('#landing')); show(qs('#app')); renderPeople(); }

  qs('#btnOpenCode').addEventListener('click', async ()=>{
    const code = qs('#accessCode').value.trim();
    const status = qs('#codeStatus');
    if(!isValidCode(code)){ status.textContent='Invalid code format'; status.classList.add('text-red-600'); return; }
    status.textContent='Verifying…'; status.classList.remove('text-red-600');
    const ok = await verifyCode(code);
    if(ok) enterApp(); else { status.textContent='Invalid/expired code'; status.classList.add('text-red-600'); }
  });
  qs('#btnWallet').addEventListener('click', ()=>{ enterApp(); });
  qs('#docsLink').addEventListener('click', e=>{ e.preventDefault(); alert('Genesis Gates: private family atlas with signed access codes, wallet login, heatmaps, and AI tools.'); });

  // ---------- Tabs ----------
  function switchTab(name){
    ['overview','map','ai','privacy'].forEach(n=>{
      qs('#panel-'+n).classList.toggle('hidden', n!==name);
      const btn = qs('.tab[data-tab="'+n+'"]'); if(btn) btn.classList.toggle('active', n===name);
    });
    if(name==='map' && !window._mapReady) initMap();
  }
  qsa('.tab').forEach(b=>b.addEventListener('click', ()=>switchTab(b.getAttribute('data-tab'))));

  // ---------- CRUD People ----------
  function renderPeople(){
    const tbody = qs('#peopleRows'); tbody.innerHTML='';
    state.people.forEach(p=>{
      const tr = document.createElement('tr');
      tr.innerHTML = \`
        <td class="py-2">\${p.name}</td>
        <td class="py-2 text-zinc-500">\${p.birth}</td>
        <td class="py-2 text-zinc-500">\${p.city}</td>
        <td class="py-2 text-right">
          <button data-id="\${p.id}" class="btnEdit text-blue-600 mr-3">Edit</button>
          <button data-id="\${p.id}" class="btnDel text-red-600">Delete</button>
        </td>\`;
      tbody.appendChild(tr);
    });
    qsa('.btnEdit').forEach(b=>b.addEventListener('click', ()=>loadToForm(b.getAttribute('data-id'))));
    qsa('.btnDel').forEach(b=>b.addEventListener('click', ()=>{ const id=b.getAttribute('data-id'); state.people=state.people.filter(x=>x.id!==id); saveState(state); renderPeople(); if(window._mapReady) refreshMap(); }));
  }
  function loadToForm(id){
    const p = state.people.find(x=>x.id===id); if(!p) return;
    qs('#pId').value=p.id; qs('#pName').value=p.name; qs('#pBirth').value=p.birth; qs('#pCity').value=p.city;
    qs('#pLat').value=p.lat||''; qs('#pLon').value=p.lon||''; qs('#pBLat').value=p.blat||''; qs('#pBLon').value=p.blon||'';
  }
  function clearForm(){ ['pId','pName','pBirth','pCity','pLat','pLon','pBLat','pBLon'].forEach(id=>qs('#'+id).value=''); }
  qs('#btnClearForm').addEventListener('click', clearForm);
  qs('#btnSavePerson').addEventListener('click', ()=>{
    const id = qs('#pId').value || uid();
    const person = {
      id,
      name: qs('#pName').value.trim() || 'Unnamed',
      birth: qs('#pBirth').value.trim() || '',
      city: qs('#pCity').value.trim() || '',
      lat: parseFloat(qs('#pLat').value)||null,
      lon: parseFloat(qs('#pLon').value)||null,
      blat: parseFloat(qs('#pBLat').value)||null,
      blon: parseFloat(qs('#pBLon').value)||null,
    };
    const idx = state.people.findIndex(x=>x.id===id);
    if(idx>=0) state.people[idx]=person; else state.people.push(person);
    saveState(state); renderPeople(); if(window._mapReady) refreshMap(); clearForm();
  });
  qs('#btnExport').addEventListener('click', ()=>download('genesis-gates.json', JSON.stringify({people:state.people},null,2)));
  qs('#fileImport').addEventListener('change', e=>{
    const f = e.target.files && e.target.files[0]; if(!f) return;
    const r = new FileReader(); r.onload=()=>{ try{ const data=JSON.parse(r.result); state.people=data.people||[]; saveState(state); renderPeople(); if(window._mapReady) refreshMap(); }catch{} }; r.readAsText(f);
  });

  // Simple geocode for convenience (Nominatim)
  qs('#btnGeo').addEventListener('click', async ()=>{
    const city = qs('#pCity').value.trim(); if(!city) return;
    try{
      const res = await fetch('https://nominatim.openstreetmap.org/search?format=json&q='+encodeURIComponent(city));
      const arr = await res.json(); if(arr && arr[0]){ qs('#pLat').value=arr[0].lat; qs('#pLon').value=arr[0].lon; }
      const birth = qs('#pBirth').value.trim(); if(birth){ const res2=await fetch('https://nominatim.openstreetmap.org/search?format=json&q='+encodeURIComponent(birth)); const a2=await res2.json(); if(a2&&a2[0]){ qs('#pBLat').value=a2[0].lat; qs('#pBLon').value=a2[0].lon; } }
    }catch(e){ alert('Geocoding failed; enter coordinates manually.'); }
  });

  // ---------- Map (heat + arcs) ----------
  let map, heatLayer, arcLayerGroup;
  function initMap(){
    window._mapReady = true;
    map = L.map('map').setView([30,10], 2);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 6, attribution:'© OpenStreetMap' }).addTo(map);
    heatLayer = L.heatLayer([], { radius: 20, blur: 15, maxZoom: 6 }).addTo(map);
    arcLayerGroup = L.layerGroup().addTo(map);
    refreshMap();
    qs('#chkHeat').addEventListener('change', ()=>{ if(qs('#chkHeat').checked){ heatLayer.addTo(map);} else { map.removeLayer(heatLayer);} });
    qs('#chkArcs').addEventListener('change', ()=>{ if(qs('#chkArcs').checked){ arcLayerGroup.addTo(map);} else { map.removeLayer(arcLayerGroup);} });
  }
  function refreshMap(){
    const pts = [];
    arcLayerGroup.clearLayers();
    state.people.forEach(p=>{
      if(Number.isFinite(p.lat)&&Number.isFinite(p.lon)){ pts.push([p.lat,p.lon, 0.6]); }
      if(qs('#chkArcs').checked && Number.isFinite(p.lat)&&Number.isFinite(p.lon)&&Number.isFinite(p.blat)&&Number.isFinite(p.blon)){
        L.polyline([[p.blat,p.blon],[p.lat,p.lon]], { color:'#6D28D9', weight:2, opacity:0.85 }).addTo(arcLayerGroup);
      }
    });
    heatLayer.setLatLngs(pts);
  }

  // ---------- Owner Mode: keys + signed codes (demo) ----------
  async function createOwnerKey(passphrase){
    const keyPair = await crypto.subtle.generateKey({ name:'ECDSA', namedCurve:'P-256' }, true, ['sign','verify']);
    // Export & wrap private key with passphrase-derived key (AES-GCM)
    const rawPriv = await crypto.subtle.exportKey('pkcs8', keyPair.privateKey);
    const salt = crypto.getRandomValues(new Uint8Array(16));
    const iv = crypto.getRandomValues(new Uint8Array(12));
    const encKey = await crypto.subtle.importKey('raw', await crypto.subtle.digest('SHA-256', new TextEncoder().encode(passphrase)), { name:'AES-GCM' }, false, ['encrypt','decrypt']);
    const encPriv = await crypto.subtle.encrypt({ name:'AES-GCM', iv }, encKey, rawPriv);
    const pubJwk = await crypto.subtle.exportKey('jwk', keyPair.publicKey);
    state.key = { salt: arrayToB64(salt), iv: arrayToB64(iv), data: arrayToB64(new Uint8Array(encPriv)) };
    state.pubJwk = pubJwk;
    saveState(state);
    return true;
  }
  function arrayToB64(arr){ return btoa(String.fromCharCode.apply(null, arr)); }
  function b64ToArray(str){ return Uint8Array.from(atob(str), c=>c.charCodeAt(0)); }

  async function getPrivateKey(passphrase){
    if(!state.key) return null;
    try{
      const encKey = await crypto.subtle.importKey('raw', await crypto.subtle.digest('SHA-256', new TextEncoder().encode(passphrase)), { name:'AES-GCM' }, false, ['decrypt']);
      const raw = await crypto.subtle.decrypt({ name:'AES-GCM', iv: b64ToArray(state.key.iv) }, encKey, b64ToArray(state.key.data));
      return await crypto.subtle.importKey('pkcs8', raw, { name:'ECDSA', namedCurve:'P-256' }, false, ['sign']);
    }catch{ return null; }
  }
  async function getPublicKey(){ if(!state.pubJwk) return null; return await crypto.subtle.importKey('jwk', state.pubJwk, { name:'ECDSA', namedCurve:'P-256' }, false, ['verify']); }

  function toBlocks(str){
    // Turn base64 token into 5x5 Crockford-like blocks for UX (not full Crockford)
    const clean = str.replace(/[^A-Z0-9]/gi,'').toUpperCase();
    const chunks=[]; for(let i=0;i<25;i+=5){ chunks.push((clean[i]||'A')+(clean[i+1]||'A')+(clean[i+2]||'A')+(clean[i+3]||'A')+(clean[i+4]||'A')); }
    return chunks.join('-');
  }

  async function signToken(treeId, days, passphrase){
    const priv = await getPrivateKey(passphrase); if(!priv) throw new Error('No/invalid key');
    const exp = Date.now() + (parseInt(days||'14')*24*60*60*1000);
    const payload = new TextEncoder().encode(JSON.stringify({ t: treeId||'default', e: exp }));
    const sig = await crypto.subtle.sign({ name:'ECDSA', hash:'SHA-256' }, priv, payload);
    const token = btoa(String.fromCharCode.apply(null, new Uint8Array(sig))).slice(0,25); // compact demo token
    return toBlocks(token);
  }

  // Buttons
  qs('#btnLogout').addEventListener('click', ()=>{ hide(qs('#app')); show(qs('#landing')); });
  qs('#btnShowAccess').addEventListener('click', ()=>{ const m=qs('#accessModal'); m.classList.remove('hidden'); m.classList.add('flex'); });
  qs('#btnCloseAccess').addEventListener('click', ()=>{ const m=qs('#accessModal'); m.classList.add('hidden'); m.classList.remove('flex'); });
  qs('#btnCopyShare').addEventListener('click', async ()=>{ await navigator.clipboard.writeText(qs('#shareCode').textContent); alert('Access code copied'); });
  qs('#btnGenCode').addEventListener('click', async ()=>{
    const treeId = qs('#shareTreeId').value.trim()||'default';
    const days = qs('#shareExpiry').value.trim()||'14';
    const pass = prompt('Enter owner passphrase to sign'); if(!pass) return;
    try{ const code = await signToken(treeId, days, pass); qs('#shareCode').textContent = code; }catch(e){ alert('Failed to sign code. Create/unlock your key in Owner Mode.'); }
  });

  // Owner mode
  qs('#btnOwner').addEventListener('click', ()=>{ const m=qs('#ownerModal'); m.classList.remove('hidden'); m.classList.add('flex'); });
  qs('#btnOwnerClose').addEventListener('click', ()=>{ const m=qs('#ownerModal'); m.classList.add('hidden'); m.classList.remove('flex'); });
  qs('#btnOwnerCreate').addEventListener('click', async ()=>{
    const pass = qs('#ownerPass').value.trim(); if(!pass){ alert('Enter a passphrase'); return; }
    await createOwnerKey(pass);
    qs('#ownerStatus').textContent = 'Owner key stored locally. Public JWK saved in this browser.';
    alert('Owner key ready. Use "Get Access Code" to generate viewer codes.');
  });

  // Start
  function start(){ renderPeople(); }
  start();
})();
</script>
</body>
</html>
