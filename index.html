<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Genesis Gates</title>
  <meta name="description" content="Genesis Gates — clean, privacy-first family atlas with access codes, wallet sign-in, maps, and AI tools."/>
  <link rel="icon" type="image/png" href="assets/favicon-256.png">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: { gg: { primary: '#6D28D9', dark: '#4C1D95' } },
          borderRadius: { '2xl': '1rem' }
        }
      }
    }
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Playfair+Display:wght@600&display=swap" rel="stylesheet">
  <style>
    html, body { font-family: Inter, ui-sans-serif, system-ui, -apple-system; }
    .brand { font-family: Playfair Display, serif; }
  </style>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
</head>
<body class="bg-zinc-50 text-zinc-900">
  <!-- Landing -->
  <main id="landing" class="min-h-screen flex items-center justify-center p-6">
    <div class="w-full max-w-xl">
      <div class="flex flex-col items-center">
        <img src="assets/logo.png" alt="Genesis Gates logo" class="w-24 h-24 object-contain mb-5" onerror="this.style.display='none'">
        <h1 class="brand text-4xl md:text-5xl font-semibold tracking-tight">Genesis Gates</h1>
        <p class="mt-3 text-zinc-500 text-center max-w-md">Your family history. Decentralized. Immortalized.</p>
      </div>

      <div class="mt-8 rounded-2xl bg-white border shadow-sm p-5">
        <label for="accessCode" class="block text-sm mb-2">Enter Access Code</label>
        <div class="flex gap-2">
          <input id="accessCode" class="flex-1 rounded-xl border px-3 py-3 uppercase" placeholder="ABCDE-ABCDE-ABCDE-ABCDE-ABCDE">
          <button id="btnOpenCode" class="rounded-xl px-5 py-3 bg-gg-primary text-white">Unlock</button>
        </div>
        <p id="codeStatus" class="text-xs text-zinc-500 mt-2">Codes are long and unguessable. Rotate anytime.</p>

        <div class="flex items-center justify-between mt-4">
          <button id="btnWallet" class="rounded-xl px-4 py-2 border">Sign in with Wallet</button>
          <a id="docsLink" href="#" class="text-sm text-zinc-500 hover:underline">What is Genesis Gates?</a>
        </div>
      </div>

      <p class="text-xs text-zinc-400 text-center mt-6">Private fields are encrypted client-side and visible only to invited wallets or token holders.</p>
    </div>
  </main>

  <!-- App -->
  <section id="app" class="max-w-6xl mx-auto p-6 hidden">
    <header class="flex items-center justify-between mb-4">
      <div class="flex items-center gap-2">
        <img src="assets/logo.png" alt="GG" class="w-8 h-8 object-contain">
        <div class="brand text-lg">Genesis Gates</div>
      </div>
      <div class="flex items-center gap-2">
        <button id="btnShowAccess" class="rounded-xl border px-3 py-2">Get Access Code</button>
        <button id="btnLogout" class="rounded-xl border px-3 py-2">Log out</button>
      </div>
    </header>

    <div class="grid grid-cols-4 gap-2">
      <button class="tab active rounded-2xl border px-3 py-2 bg-white" data-tab="overview">Overview</button>
      <button class="tab rounded-2xl border px-3 py-2 bg-white" data-tab="map">Map</button>
      <button class="tab rounded-2xl border px-3 py-2 bg-white" data-tab="ai">AI</button>
      <button class="tab rounded-2xl border px-3 py-2 bg-white" data-tab="privacy">Privacy</button>
    </div>

    <div id="panel-overview" class="mt-6">
      <div class="rounded-2xl bg-white border shadow-sm p-5">
        <div class="font-medium mb-4">Family (minimal view)</div>
        <div id="peopleGrid" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
        <div class="rounded-2xl bg-white border shadow-sm p-5">
          <div class="font-medium">Quick Links</div>
          <ul class="text-sm text-zinc-600 mt-2 list-disc pl-5">
            <li>Timeline of family milestones</li>
            <li>Stories & oral histories</li>
            <li>Documents & certificates</li>
            <li>Ancestor badges & NFTs</li>
          </ul>
        </div>
        <div class="rounded-2xl bg-white border shadow-sm p-5">
          <div class="font-medium">Contextual History</div>
          <ul class="text-sm text-zinc-600 mt-2 list-disc pl-5">
            <li>Auto-link places to summaries</li>
            <li>Surname origins & etymology</li>
            <li>Notable events during ancestor lifetimes</li>
          </ul>
        </div>
      </div>
    </div>

    <div id="panel-map" class="mt-6 hidden">
      <div class="rounded-2xl bg-white border shadow-sm p-5">
        <div class="font-medium mb-3">Family Map</div>
        <div id="map" class="w-full h-[520px] rounded-xl border"></div>
        <p class="text-xs text-zinc-500 mt-2">Lines show birthplace → current city per person. Circle size reflects relatives in a city.</p>
      </div>
    </div>

    <div id="panel-ai" class="mt-6 hidden">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="rounded-2xl bg-white border shadow-sm p-5">
          <div class="font-medium">AI Photo Tagger (face detection)</div>
          <p class="text-xs text-zinc-500 mb-3">Detect faces locally. Models load on first use.</p>
          <div class="flex items-center gap-2 mb-2">
            <button id="btnLoadFace" class="rounded-xl border px-3 py-2">Load models</button>
            <span id="faceStatus" class="text-xs text-zinc-500">Models: not loaded</span>
          </div>
          <input id="faceFile" type="file" accept="image/*" class="mb-2"/>
          <div id="faceCanvas" class="rounded-xl border p-2 min-h-[140px] flex items-center justify-center text-xs text-zinc-500">Drop a portrait to detect faces…</div>
          <div class="text-xs text-zinc-500 mt-2">Detected faces: <span id="faceCount">0</span></div>
        </div>

        <div class="rounded-2xl bg-white border shadow-sm p-5">
          <div class="font-medium">AI Document Search (OCR demo)</div>
          <p class="text-xs text-zinc-500 mb-2">Drop a JPG/PNG scan — extract text in-browser.</p>
          <input id="ocrFile" type="file" accept="image/*" class="mb-2"/>
          <textarea id="ocrText" class="w-full h-40 text-sm border rounded-md p-2" placeholder="Extracted text will appear here…"></textarea>
        </div>
      </div>
    </div>

    <div id="panel-privacy" class="mt-6 hidden">
      <div class="rounded-2xl bg-white border shadow-sm p-5 text-sm text-zinc-700">
        <div class="font-medium mb-2">Privacy & Security</div>
        <ul class="list-disc pl-5 space-y-1">
          <li>Client‑side encryption for private fields.</li>
          <li>Decentralized DB for the tree; IPFS for media.</li>
          <li>Rotatable, signed access codes for viewing.</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- Simple access-code modal -->
  <div id="accessModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center">
    <div class="bg-white rounded-2xl p-6 w-[90%] max-w-xl shadow-xl">
      <div class="font-medium mb-2">Share your tree securely</div>
      <p class="text-sm text-zinc-500">Anyone with the access code can view your tree. Rotate anytime.</p>
      <div class="rounded-xl border p-3 flex items-center justify-between mt-3">
        <code id="shareCode" class="text-lg font-mono">W7K3J-S9D2M-1HA9Z-QP8TU-3L0BN</code>
        <button id="btnCopyShare" class="rounded-xl border px-3 py-2">Copy</button>
      </div>
      <div class="text-right mt-4">
        <button id="btnCloseAccess" class="rounded-xl border px-3 py-2">Close</button>
      </div>
    </div>
  </div>

  <!-- External JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5.1.1/dist/tesseract.min.js"></script>
  <script>
  (function(){
    // Demo people (keep minimal; replace later)
    const PEOPLE = [
      { id: "p1", name: "Alex Pioneer", city: "San Diego, USA", lat: 32.7157, lon: -117.1611, born: "Baghdad, Iraq", blat: 33.3152, blon: 44.3661 },
      { id: "p2", name: "Brianna Pioneer", city: "Phoenix, USA", lat: 33.4484, lon: -112.0740, born: "Erbil, Iraq", blat: 36.1911, blon: 44.0092 }
    ];

    const qs = s => document.querySelector(s);
    const qsa = s => Array.from(document.querySelectorAll(s));
    function show(el){ el.classList.remove('hidden'); }
    function hide(el){ el.classList.add('hidden'); }

    function renderPeople(){
      const grid = qs('#peopleGrid'); grid.innerHTML = '';
      PEOPLE.forEach(p => {
        const initials = p.name.split(' ').map(s=>s[0]).slice(0,2).join('');
        const el = document.createElement('div');
        el.className = 'rounded-xl border p-3';
        el.innerHTML = '<div class="flex items-center gap-3">'
          + '<div class="h-10 w-10 rounded-full bg-zinc-100 flex items-center justify-center">'+initials+'</div>'
          + '<div><div class="font-medium leading-tight">'+p.name+'</div>'
          + '<div class="text-xs text-zinc-500">'+p.city+'</div></div></div>';
        grid.appendChild(el);
      });
    }

    function enterApp(){ hide(qs('#landing')); show(qs('#app')); renderPeople(); }
    function isValidCode(str){ return /^[A-Z2-7]{5}(-[A-Z2-7]{5}){4}$/.test((str||'').toUpperCase()); }
    function openCode(){
      const code = qs('#accessCode').value.trim().toUpperCase();
      const status = qs('#codeStatus');
      if(!isValidCode(code)){ status.textContent='Invalid code format'; status.classList.add('text-red-600'); return; }
      status.textContent='Opening…'; status.classList.remove('text-red-600');
      enterApp();
    }
    function switchTab(name){
      ['overview','map','ai','privacy'].forEach(n=>{
        qs('#panel-'+n).classList.toggle('hidden', n!==name);
        const btn = qs('.tab[data-tab="'+n+'"]'); if(btn) btn.classList.toggle('active', n===name);
      });
      if(name==='map' && !window._mapReady) initMap();
    }

    function initMap(){
      window._mapReady = true;
      const map = L.map('map').setView([30,10], 2);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 6, attribution: '© OpenStreetMap' }).addTo(map);
      const counts = new Map();
      PEOPLE.forEach(p=>{
        if(!(Number.isFinite(p.lat)&&Number.isFinite(p.lon))) return;
        const key = p.city+'|'+p.lat+'|'+p.lon; counts.set(key, (counts.get(key)||0)+1);
      });
      counts.forEach((count, key)=>{
        const [city, lat, lon] = key.split('|');
        const r = 6 + Math.min(10, count*2);
        L.circleMarker([+lat,+lon], { radius:r, color:'#111827', fillColor:'#111827', fillOpacity:0.7 })
          .bindTooltip(city+' ('+count+')').addTo(map);
      });
      PEOPLE.forEach(p=>{
        if(Number.isFinite(p.lat)&&Number.isFinite(p.lon)&&Number.isFinite(p.blat)&&Number.isFinite(p.blon)){
          L.polyline([[p.blat,p.blon],[p.lat,p.lon]], { color:'#6D28D9', weight:2, opacity:0.85 }).addTo(map);
        }
      });
    }

    // AI: OCR
    async function runOCR(file){
      if(!file) return;
      const textarea = qs('#ocrText'); textarea.value='Processing…';
      try{ const { data } = await Tesseract.recognize(file, 'eng'); textarea.value = data.text || ''; }
      catch(e){ textarea.value = 'OCR failed. Try a clearer image.'; }
    }

    // AI: Face detection
    let faceModelsLoaded=false;
    async function loadFaceModels(){
      const status = qs('#faceStatus'); status.textContent = 'Loading models…';
      try{
        await import('https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js');
        const base='https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/weights';
        await window.faceapi.nets.ssdMobilenetv1.loadFromUri(base);
        await window.faceapi.nets.faceLandmark68Net.loadFromUri(base);
        await window.faceapi.nets.faceRecognitionNet.loadFromUri(base);
        faceModelsLoaded=true; status.textContent='Models ready';
      }catch(e){ status.textContent='Failed to load models'; }
    }
    async function runFaceDetect(file){
      if(!file) return;
      if(!faceModelsLoaded){ alert('Click "Load models" first'); return; }
      const url = URL.createObjectURL(file);
      const img = new Image();
      img.onload = async () => {
        const canvas = qs('#faceCanvas'); canvas.innerHTML=''; canvas.appendChild(img);
        try{
          const detections = await window.faceapi.detectAllFaces(img).withFaceLandmarks().withFaceDescriptors();
          qs('#faceCount').textContent = (detections && detections.length) ? detections.length : 0;
        }catch(e){ qs('#faceCount').textContent = '0'; }
      };
      img.src = url;
    }

    // Wire events
    document.addEventListener('DOMContentLoaded', () => {
      qs('#btnOpenCode').addEventListener('click', openCode);
      qs('#btnWallet').addEventListener('click', enterApp);
      qs('#docsLink').addEventListener('click', e => { e.preventDefault(); alert('Genesis Gates is a privacy-first family atlas. Access is controlled with signed codes and wallet-based invites.'); });
      qs('#btnLogout').addEventListener('click', ()=>{ hide(qs('#app')); show(qs('#landing')); });
      qs('#btnShowAccess').addEventListener('click', ()=>{ const m=qs('#accessModal'); m.classList.remove('hidden'); m.classList.add('flex'); });
      qs('#btnCloseAccess').addEventListener('click', ()=>{ const m=qs('#accessModal'); m.classList.add('hidden'); m.classList.remove('flex'); });
      qs('#btnCopyShare').addEventListener('click', async ()=>{ await navigator.clipboard.writeText(qs('#shareCode').textContent); alert('Access code copied'); });

      document.querySelectorAll('.tab').forEach(btn => btn.addEventListener('click', ()=>switchTab(btn.getAttribute('data-tab'))));
      qs('#ocrFile').addEventListener('change', e=>runOCR(e.target.files && e.target.files[0]));
      qs('#btnLoadFace').addEventListener('click', loadFaceModels);
      qs('#faceFile').addEventListener('change', e=>runFaceDetect(e.target.files && e.target.files[0]));
    });
  })();
  </script>
</body>
</html>
